<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Text Link Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
input, textarea, button { width: 100%; margin: 8px 0; padding: 10px; font-size: 16px; }
#output, #shortLinkBox { margin-top: 15px; word-break: break-all; border: 1px solid #aaa; padding: 10px; }
</style>
</head>
<body>

<h2>Enter Key and Text</h2>
<input id="keyInput" placeholder="Key (e.g. A, 1)">
<textarea id="textInput" rows="5" placeholder="Text to save"></textarea>
<button onclick="generateLink()">Generate Link</button>

<div id="linkBox"></div>
<div id="shortLinkBox"></div>
<div id="output"></div>

<script>
// Encode text â†’ URL and show text
function generateLink() {
  const key = document.getElementById("keyInput").value.trim();
  const text = document.getElementById("textInput").value.trim();
  if (!key || !text) {
    alert("Enter both key and text.");
    return;
  }
  
  // Encode both in URL hash
  const fragment = encodeURIComponent(key) + "|" + encodeURIComponent(text);
  const longUrl = location.origin + location.pathname + "#" + fragment;
  document.getElementById("linkBox").textContent = "Long Link: " + longUrl;

  // Display immediately
  showOutput(text);

  // Now shorten using TinyURL API
  const apiUrl = "https://tinyurl.com/api-create.php?url=" + encodeURIComponent(longUrl);
  fetch(apiUrl)
    .then(res => res.text())
    .then(shortUrl => {
      document.getElementById("shortLinkBox").textContent =
        "Short Link: " + shortUrl + " ";
    })
    .catch(err => {
      document.getElementById("shortLinkBox").textContent =
        "Shortening failed: " + err;
    });
}

// If page opened with #key|text, display it
function loadFromHash() {
  if (!location.hash) return;
  const frag = decodeURIComponent(location.hash.slice(1));
  const parts = frag.split("|");
  if (parts.length === 2) {
    const key = parts[0], text = parts[1];
    document.getElementById("keyInput").value = key;
    document.getElementById("textInput").value = text;
    showOutput(text);
  }
}

function showOutput(text) {
  document.getElementById("output").textContent = "Text: " + text;
}

window.addEventListener("hashchange", loadFromHash);
loadFromHash();
</script>

</body>
</html>
