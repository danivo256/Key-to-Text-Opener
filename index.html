<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Key to Text</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; padding: 20px; }
input, button { width: 100%; margin: 8px 0; padding: 10px; font-size: 16px; }
#editor { border:1px solid #aaa; min-height:120px; padding:10px; }
#output { margin-top:20px; padding:12px; border:1px solid #444; }
#info { margin-top:10px; word-break:break-all; font-size:14px; }
</style>
</head>

<body>

<h2>Enter Key</h2>
<input id="keyInput" placeholder="e.g. formula1">

<h2>Enter Text (formatting supported)</h2>
<div id="editor" contenteditable="true"></div>

<button onclick="copyAll()">Copy Share Link</button>

<div id="info"></div>
<div id="output"></div>

<script>
function copyAll() {
  const key = keyInput.value.trim();
  const html = editor.innerHTML.trim();

  if (!key || !html) {
    alert("Enter key and text");
    return;
  }

  const data = encodeURIComponent(key + "||" + html);
  const longUrl = location.origin + location.pathname + "#" + data;

  output.innerHTML = html;
  info.textContent = "Generating short link...";

  fetch("https://tinyurl.com/api-create.php?url=" + encodeURIComponent(longUrl))
    .then(r => r.text())
    .then(t => {
      t = t.trim();
      if (!t.startsWith("http")) {
        alert("Shortener failed. Long link copied instead.");
        navigator.clipboard.writeText(longUrl);
        info.textContent = "Copied long link:\n" + longUrl;
        return;
      }
      navigator.clipboard.writeText(t);
      info.textContent = "Short link copied:\n" + t;
      alert("Short link copied");
    })
    .catch(() => {
      navigator.clipboard.writeText(longUrl);
      info.textContent = "Copied long link:\n" + longUrl;
      alert("Shortener error. Long link copied.");
    });
}

function loadFromHash() {
  if (!location.hash) return;
  const d = decodeURIComponent(location.hash.slice(1));
  const p = d.split("||");
  if (p.length !== 2) return;
  keyInput.value = p[0];
  editor.innerHTML = p[1];
  output.innerHTML = p[1];
}

window.addEventListener("hashchange", loadFromHash);
loadFromHash();
</script>

</body>
</html>
