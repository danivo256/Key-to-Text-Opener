<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Key to Text</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; padding: 20px; }
input, button { width: 100%; margin: 8px 0; padding: 10px; font-size: 16px; }
#editor { border:1px solid #aaa; min-height:120px; padding:10px; }
#output { margin-top:20px; padding:12px; border:1px solid #444; }
#linkBox, #shortBox { margin-top:10px; word-break:break-all; font-size:14px; }
</style>
</head>

<body>

<h2>Enter Key</h2>
<input id="keyInput" placeholder="e.g. formula1">

<h2>Enter Text (bold, new lines supported)</h2>
<div id="editor" contenteditable="true"></div>

<button onclick="copyAll()">Copy Share Link</button>

<div id="linkBox"></div>
<div id="shortBox"></div>
<div id="output"></div>

<script>
let lastShort = "";

function copyAll() {
  const key = keyInput.value.trim();
  const html = editor.innerHTML.trim();

  if (!key || !html) {
    alert("Enter key and text");
    return;
  }

  const data = encodeURIComponent(key + "||" + html);
  const longUrl = location.origin + location.pathname + "#" + data;

  linkBox.textContent = "Long link: " + longUrl;
  output.innerHTML = html;

  // WORKING shortener API
  fetch("https://tinyurl.com/api-create.php?url=" + encodeURIComponent(longUrl))
    .then(r => r.text())
    .then(shortUrl => {
      lastShort = shortUrl.trim();
      shortBox.textContent = "Short link: " + lastShort;
      navigator.clipboard.writeText(lastShort);
      alert("Short link copied");
    })
    .catch(() => {
      alert("Short link failed");
    });
}

function loadFromHash() {
  if (!location.hash) return;

  const decoded = decodeURIComponent(location.hash.slice(1));
  const p = decoded.split("||");
  if (p.length !== 2) return;

  keyInput.value = p[0];
  editor.innerHTML = p[1];
  output.innerHTML = p[1];
}

window.addEventListener("hashchange", loadFromHash);
loadFromHash();
</script>

</body>
</html>
